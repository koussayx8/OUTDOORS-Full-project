<app-breadcrumbs title="Overview" [breadcrumbItems]="breadCrumbItems"></app-breadcrumbs>
<!-- End Breadcrumbs -->

<div class="row">
  <div class="col-xxl-9">
    <div class="card">
      <div class="card-body">
        <div class="row align-items-center justify-content-center g-3">
          <div class="col-xl-4 col-md-6">
            <div class="text-center rounded-3 overflow-hidden position-relative">
              <img [src]="centre?.image"
                   alt="Centre de camping"
                   class="w-100 object-fit-cover border"
                   style="height: 250px;">
            </div>
          </div>
          <div class="col-xl-8 col-md-7">
            <div>
              <div class="mb-3">
                <h6 class="card-title">{{ centre?.name }}</h6>
              </div>
              <div>
                <div class="table-responsive">
                  <table class="table table-sm table-nowrap table-borderless mb-0">
                    <tbody>
                    <tr>
                      <th>Address :</th>
                      <td>{{ centre?.address }}</td>
                    </tr>
                    <tr>
                      <th>Capacity :</th>
                      <td>{{ centre?.capcite }}</td>
                    </tr>
                    <tr>
                      <th>Price per Day:</th>
                      <td>{{ centre?.prixJr }} TND</td>
                    </tr>
                    <tr>
                      <th>Phone number:</th>
                      <td>{{centre?.numTel}}</td>
                    </tr>
                    </tbody>
                  </table>
                </div>
                <ul class="list-unstyled hstack gap-2 mb-0 mt-4">
                  <li>
                    <a href="javascript:void(0);" class="avatar-xs d-inline-block" (click)="editItem(centre?.idCentre)">
                      <div class="avatar-title rounded bg-primary-subtle text-primary">
                        <i class="bi bi-pencil-square"></i>
                      </div>
                    </a>
                  </li>
                  <li>
                    <a href="javascript:void(0);" class="avatar-xs d-inline-block" (click)="removeItem(centre?.idCentre)">
                      <div class="avatar-title bg-danger-subtle text-danger rounded">
                        <i class="bi bi-trash3"></i>
                      </div>
                    </a>
                  </li>
                  <li>
                    <button class="btn btn-outline-success" (click)="toggleView()">
                      <i class="bi bi-calendar3 me-1"></i>
                      {{ showCalendar ? 'Show Items Lis' : 'Show Calendar & Stats' }}
                    </button>
                  </li>
                </ul>


              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-body">
        <div class="mb-3">
          <h6 class="card-title mb-3">Property Overview</h6>
          <div class="row g-3">
            <div class="col-xl-3 col-sm-6">
              <div class="p-3 border border-dashed rounded">
                <div class="d-flex align-items-center gap-2">
                  <div class="avatar-xs flex-shrink-0">
                    <div class="avatar-title bg-dark-subtle text-dark fs-lg rounded">
                      <i class="bi bi-tag"></i>
                    </div>
                  </div>
                  <p class="fs-md mb-0">From {{priceRange.min}} TND  To  {{priceRange.max}} TND</p>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-sm-6">
              <div class="p-3 border border-dashed rounded">
                <div class="d-flex align-items-center gap-2">
                  <div class="avatar-xs flex-shrink-0">
                    <div class="avatar-title bg-warning-subtle text-warning fs-lg rounded">
                      <i class="bi bi-house"></i>
                    </div>
                  </div>
                  <p class="fs-md mb-0">{{ getTotalLogmentQuantity() }} Bedrooms</p>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-sm-6">
              <div class="p-3 border border-dashed rounded">
                <div class="d-flex align-items-center gap-2">
                  <div class="avatar-xs flex-shrink-0">
                    <div class="avatar-title bg-danger-subtle text-danger fs-lg rounded">
                      <i class="ph ph-bathtub"></i>
                    </div>
                  </div>
                  <p class="fs-md mb-0">{{ getTotalMaterielQuantity() }} Tools</p>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-sm-6">
              <div class="p-3 border border-dashed rounded">
                <div class="d-flex align-items-center gap-2">
                  <div class="avatar-xs flex-shrink-0">
                    <div class="avatar-title bg-info-subtle text-info fs-lg rounded">
                      <i class="bi bi-p-circle"></i>
                    </div>
                  </div>
                  <p class="fs-md mb-0">Parking Available</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row justify-content-between align-items-center mb-4">
      <div class="col-lg-12">

        <!-- Calendar and Stats View -->
        <div *ngIf="showCalendar; else listsView">
          <!-- Calendar/Stats Tabs -->
          <ul class="nav nav-pills nav-secondary mb-3" role="tablist">
            <li class="nav-item">
              <a [class.active]="calendarTab === 'calendar'" class="nav-link" data-bs-toggle="tab" href="javascript:void(0);" (click)="calendarTab = 'calendar'" role="tab">
                <i class="bi bi-calendar-check me-1"></i> Reservations Calendar
              </a>
            </li>
            <li class="nav-item">
              <a [class.active]="calendarTab === 'stats'" class="nav-link" data-bs-toggle="tab" href="javascript:void(0);" (click)="calendarTab = 'stats'" role="tab">
                <i class="bi bi-bar-chart-line me-1"></i> Statistics
              </a>
            </li>
          </ul>

          <!-- Calendar/Stats Content -->
          <div [ngSwitch]="calendarTab">
            <!-- Calendar Tab Content -->
            <div *ngSwitchCase="'calendar'" class="calendar-wrapper">
              <full-calendar [options]="calendarOptions"></full-calendar>
            </div>

            <!-- Statistics Tab Content -->
            <div *ngSwitchCase="'stats'" class="stats-wrapper">
              <div class="row">
                <div class="col-lg-3 col-md-6 mb-4">
                  <div class="card file-manager-widgets" style="background-size: 95px;background-position:right bottom;">
                    <div class="card-body">
                      <div class="d-flex align-items-center mb-4">
                        <div class="flex-grow-1">
                          <div class="avatar-sm">
                            <div class="avatar-title bg-primary-subtle text-primary rounded fs-xl">
                              <i class="bi bi-people-fill"></i>
                            </div>
                          </div>
                        </div>
                      </div>
                      <h4 class="fw-semibold mb-3"><span class="counter-value" [countUp]="totalVisitors"></span></h4>
                      <p class="fw-medium text-muted mb-0">Total Visitors</p>
                    </div>
                  </div>
                </div>

                <!-- Total Income Card -->
                <div class="col-lg-3 col-md-6 mb-4">
                  <div class="card file-manager-widgets" style="background-size: 95px;background-position:right bottom;">
                    <div class="card-body">
                      <div class="d-flex align-items-center mb-4">
                        <div class="flex-grow-1">
                          <div class="avatar-sm">
                            <div class="avatar-title bg-success-subtle text-success rounded fs-xl">
                              <i class="bi bi-currency-dollar"></i>
                            </div>
                          </div>
                        </div>
                      </div>
                      <h4 class="fw-semibold mb-3"><span class="counter-value" [countUp]="totalIncome"></span> TND</h4>
                      <p class="fw-medium text-muted mb-0">Total Income</p>
                    </div>
                  </div>
                </div>

                <!-- Center Fee Income Card -->
                <div class="col-lg-3 col-md-6 mb-4">
                  <div class="card file-manager-widgets" style="background-size: 95px;background-position:right bottom;">
                    <div class="card-body">
                      <div class="d-flex align-items-center mb-4">
                        <div class="flex-grow-1">
                          <div class="avatar-sm">
                            <div class="avatar-title bg-warning-subtle text-warning rounded fs-xl">
                              <i class="bi bi-building"></i>
                            </div>
                          </div>
                        </div>
                      </div>
                      <h4 class="fw-semibold mb-3"><span class="counter-value" [countUp]="centerFeeIncome"></span> TND</h4>
                      <p class="fw-medium text-muted mb-0">Center Fee Income</p>
                    </div>
                  </div>
                </div>

                <!-- Line Items Income Card -->
                <div class="col-lg-3 col-md-6 mb-4">
                  <div class="card file-manager-widgets" style="background-size: 95px;background-position:right bottom;">
                    <div class="card-body">
                      <div class="d-flex align-items-center mb-4">
                        <div class="flex-grow-1">
                          <div class="avatar-sm">
                            <div class="avatar-title bg-info-subtle text-info rounded fs-xl">
                              <i class="bi bi-box-seam"></i>
                            </div>
                          </div>
                        </div>
                      </div>
                      <h4 class="fw-semibold mb-3"><span class="counter-value" [countUp]="lineItemsIncome"></span> TND</h4>
                      <p class="fw-medium text-muted mb-0">Line Items Income</p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Charts Row -->
              <div class="row">
                <!-- Monthly Revenue Chart -->
                <div class="col-xl-8 col-lg-7">
                  <div class="card">
                    <div class="card-header">
                      <h5 class="card-title mb-0 flex-grow-1">Revenue Analytics</h5>
                    </div>
                    <div class="card-body">
                      <div class="revenue-chart">
                        <!-- Year Navigation -->
                        <div class="year-navigation mb-3 d-flex justify-content-between align-items-center">
                          <button class="btn btn-sm btn-outline-primary"
                                  (click)="previousYear()"
                                  [disabled]="availableYears.indexOf(selectedYear) >= availableYears.length - 1">
                            <i class="fas fa-chevron-left"></i> Previous
                          </button>

                          <div class="year-display">
                            <span class="current-year fw-bold">{{selectedYear}}</span>
                          </div>

                          <button class="btn btn-sm btn-outline-primary"
                                  (click)="nextYear()"
                                  [disabled]="availableYears.indexOf(selectedYear) <= 0">
                            Next <i class="fas fa-chevron-right"></i>
                          </button>
                        </div>

                        <!-- Chart -->
                        <apx-chart
                          [series]="revenueCharts.series"
                          [chart]="revenueCharts.chart"
                          [labels]="revenueCharts.labels"
                          [legend]="revenueCharts.legend"
                          [stroke]="revenueCharts.stroke"
                          [xaxis]="revenueCharts.xaxis"
                          [plotOptions]="revenueCharts.plotOptions"
                          [fill]="revenueCharts.fill"
                          [colors]="revenueCharts.colors"
                          [markers]="revenueCharts.markers"
                          [tooltip]="revenueCharts.tooltip"
                          dir="ltr">
                        </apx-chart>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- Reservation Distribution -->
                <div class="col-xl-4 col-lg-5">
                  <div class="card card-height-100">
                    <div class="card-header">
                      <h5 class="card-title mb-0 flex-grow-1">Reservation Status</h5>
                    </div>
                    <div class="card-body text-center">
                      <div class="apex-charts" dir="ltr">
                        <apx-chart
                          [series]="confirmedReservationsChart.series"
                          [chart]="confirmedReservationsChart.chart"
                          [plotOptions]="confirmedReservationsChart.plotOptions"
                          [colors]="confirmedReservationsChart.colors"
                          [labels]="confirmedReservationsChart.labels"
                          [stroke]="confirmedReservationsChart.stroke"
                          dir="ltr">
                        </apx-chart>
                      </div>
                      <p class="text-muted mb-0">
                        {{ confirmedReservationsPercentage }}% of reservations have been confirmed
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Lists View -->
        <ng-template #listsView>
          <div class="d-flex">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <!-- Nav tabs -->
              <ul class="nav nav-pills nav-secondary" role="tablist">
                <li class="nav-item">
                  <a [class.active]="currentTab === 'Materiels'" class="nav-link" data-bs-toggle="tab" href="javascript:void(0);" (click)="changeTab('Materiels')" role="tab">Tools</a>
                </li>
                <li class="nav-item">
                  <a [class.active]="currentTab === 'Logement'" class="nav-link" data-bs-toggle="tab" href="javascript:void(0);" (click)="changeTab('Logement')" role="tab">Bedrooms</a>
                </li>
              </ul>

              <!-- 3-dots menu button -->
              <div dropdown class="dropdown">
                <button dropdownToggle class="btn btn-light btn-icon" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <i class="bi bi-three-dots-vertical"></i>
                </button>
                <ul *bsDropdownMenu class="dropdown-menu dropdown-menu-end">
                  <li><a class="dropdown-item" href="javascript:void(0);" (click)="addMateriel.show()">
                    <i class="bi bi-plus-circle me-1 align-baseline"></i>Add Materiel</a></li>
                  <li><a class="dropdown-item" href="javascript:void(0);" (click)="addLogement.show()">
                    <i class="bi bi-plus-circle me-1 align-baseline"></i>Add Logement</a></li>
                </ul>
              </div>
            </div>
          </div>

          <div class="tab-content text-muted">
            <!-- Logements Tab -->
            <div [hidden]="currentTab !== 'Logement'" class="tab-pane show active mt-2">
              <!-- Logements List -->
              <div class="row g-3">
                @for (data of logments; track $index) {
                  <!-- Logement Card -->
                  <div class="col-lg-6 col-md-6">
                    <div class="card h-100">
                      <div class="card-body" style="height: 130px;">
                        <div class="row">
                          <div class="col-md-4">
                            <div class="position-relative" style="height: 120px;">
                              <img [src]="data.image" alt="" class="img-fluid rounded h-100 w-100 object-fit-cover">
                            </div>
                          </div>
                          <div class="col-md-8">
                            <div class="d-flex flex-column h-100">
                              <div class="d-flex justify-content-between align-items-start mb-2">
                                <div>
                                  <h6 class="fs-lg text-capitalize mb-1">{{data.type}}</h6>
                                  <p class="text-muted mb-1">
                                    <i class="bi bi-house align-baseline text-primary me-1"></i>
                                    {{data.quantity}} Bedroom
                                  </p>
                                  <p class="text-muted small mb-2">
                                    {{data.description || 'No description available'}}
                                  </p>
                                </div>
                                <h5 class="text-nowrap">{{data.price}} TND</h5>
                              </div>
                              <div class="mt-auto">
                                <div class="d-flex gap-2">
                                  <button class="btn btn-sm btn-outline-primary" (click)="editLogement(data.idLogement)">
                                    <i class="bi bi-pencil-square me-1"></i> Edit
                                  </button>
                                  <button class="btn btn-sm btn-outline-danger" (click)="removeLogement(data.idLogement)">
                                    <i class="bi bi-trash me-1"></i> Delete
                                  </button>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                }
              </div>
            </div>
            <!-- Materiels Tab -->
            <div [hidden]="currentTab !== 'Materiels'" class="tab-pane show active">
              <!-- Materiels List -->
              <div class="row mt-3">
                @for (data of materiels; track $index) {
                  <!-- Materiel Card -->
                  <div class="col-xxl-3 col-sm-6 mb-4">
                    <div class="card real-estate-grid-widgets card-animate shadow-sm h-100">
                      <div class="card-body p-0 position-relative" style="height: 180px; min-height: 180px;">
                        <img src="{{data.image}}" alt="" class="rounded-top w-100 h-100 object-fit-cover">
                        <div dropdown container="body" class="dropdown dropdown-real-estate position-absolute" style="top: 10px; right: 10px;">
                          <button dropdownToggle class="btn btn-light btn-icon btn-sm" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-three-dots-vertical"></i>
                          </button>
                          <ul *bsDropdownMenu class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="javascript:void(0);" (click)="editMateriel(data.idMateriel)">
                              <i class="bi bi-pencil-square me-1 align-baseline"></i>Edit</a></li>
                            <li><a class="dropdown-item" href="javascript:void(0);" (click)="removeMateriel(data.idMateriel)">
                              <i class="bi bi-trash3 me-1 align-baseline"></i>Delete</a></li>
                          </ul>
                        </div>
                      </div>
                      <div class="card-body p-3">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                          <a href="javascript:void(0);" class="text-decoration-none">
                            <h6 class="fs-5 text-capitalize mb-0 text-truncate">{{data.name}}</h6>
                          </a>
                        </div>
                        <div class="mb-2">
                      <span class="badge bg-success-subtle text-success rounded px-2 py-1 d-inline-flex align-items-center">
                        <i class="bi bi-tag-fill me-1"></i> <span class="fw-medium">{{data.type}}</span>
                      </span>
                        </div>
                        <div class="description-container mb-3" style="height: 32px; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
                          <p class="text-muted mb-0 small">{{data.description || 'No description available'}}</p>
                        </div>
                        <div class="mb-3">
                          <span class="badge bg-primary-subtle text-primary rounded-pill px-3 py-2">Quantity : {{data.quantity}} </span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mt-auto pt-2 border-top border-dashed">
                          <h5 class="fw-bold mb-0 text-dark">{{data.price}} TND</h5>
                        </div>
                      </div>
                    </div>
                  </div>
                }
              </div>
            </div>
          </div>
        </ng-template>
      </div>
    </div>
  </div><!--end col-->

  <div class="col-xxl-3">
    <div class="row">
      <div class="col-lg-12">
        <div class="card">
          <div class="card-body">
            <div class="d-flex align-items-center mb-4">
              <div class="flex-grow-1">
                <button type="button" class="btn btn-subtle-warning custom-toggle btn-icon btn-sm" >
                  <span class="icon-on"><i class="bi bi-star"></i></span>
                  <span class="icon-off"><i class="bi bi-star-fill"></i></span>
                </button>
              </div>
            </div>
            <div *ngIf="ownerCentre; else noOwnerData" class="text-center">
              <img [src]="ownerCentre.image || 'assets/images/default-profile.jpg'" alt="" class="avatar-md rounded mx-auto d-block">
              <h5 class="mt-3">{{ownerCentre.prenom}} {{ownerCentre.nom}} <i class="bi bi-patch-check-fill align-baseline text-info ms-1"></i></h5>
              <p class="text-muted">Owner</p>
              <div class="table-responsive">
                <table class="table table-sm table-nowrap table-borderless mb-0">
                  <tbody>
                  <tr>
                    <th>First Name</th>
                    <td>{{ownerCentre.prenom}}</td>
                  </tr>
                  <tr>
                    <th>Last Name</th>
                    <td>{{ownerCentre.nom}}</td>
                  </tr>
                  <tr>
                    <th>Email Address</th>
                    <td>{{ownerCentre.email}}</td>
                  </tr>
                  <tr>
                    <th>Phone Number</th>
                    <td>{{ownerCentre.tel}}</td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <ng-template #noOwnerData>
              <div class="alert alert-info text-center">
                <p>Owner information is not available</p>
              </div>
            </ng-template>
            <ul class="list-unstyled hstack justify-content-center gap-2 mb-0 mt-4">
              <!-- Social links remain unchanged -->
            </ul>
          </div>
        </div>
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Center Location</h5>
            <div *ngIf="centre?.latitude && centre?.longitude; else noLocation"
                 style="height: 300px;"
                 leaflet
                 [leafletOptions]="centerMapOptions">
            </div>
            <ng-template #noLocation>
              <div class="alert alert-info">Location data not available for this center</div>
            </ng-template>
          </div>
        </div>
        <div class="card">
          <div class="card-header">
            <h5 class="card-title mb-0">Clients</h5>
          </div>
          <div class="card-body px-0">
            <ngx-simplebar class="card-body py-0" style="max-height: 330px;">
              <div class="table-responsive table-card mt-0">
                <table class="table mb-0">
                  <tbody>
                  <tr *ngFor="let user of reservationUsers">
                    <td>
                      <div class="d-flex align-items-center gap-1">
                        <div class="flex-shrink-0">
                          <img [src]="user.image " alt="" class="avatar-sm rounded-circle p-1">
                        </div>
                        <div class="flex-grow-1">
                          <h6 class="fs-md mb-1">{{ user.prenom }} {{ user.nom }}</h6>
                          <p class="text-muted mb-0">{{ user.email }}</p>
                        </div>
                      </div>
                    </td>
                    <td class="text-end">
                      <span class="badge bg-primary-subtle text-primary">
                        <i class="bi bi-telephone"></i> {{ user.tel }}
                      </span>
                    </td>
                  </tr>
                  <tr *ngIf="reservationUsers.length === 0">
                    <td colspan="2" class="text-center py-3">
                      <p class="text-muted mb-0">No users with reservations found</p>
                    </td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </ngx-simplebar>
          </div>
        </div>
        <div class="card">
          <div class="card-header d-flex align-items-center">
            <h6 class="card-title mb-0 flex-grow-1">Customer Reviews</h6>
            <div class="flex-shrink-0">
              <span *ngIf="isLoadingReviews" class="spinner-border spinner-border-sm text-primary me-2"></span>
              <button class="btn btn-sm btn-outline-primary" (click)="refreshReviews()">
                <i class="bi bi-arrow-clockwise me-1"></i>Refresh
              </button>
            </div>
          </div>
          <div class="card-body px-0">
            <ngx-simplebar class="card-body py-0" style="max-height: 330px;">
              <div *ngIf="reviewsWithDetails && reviewsWithDetails.length > 0; else noReviews">
                <div class="d-flex p-3 border-bottom" *ngFor="let reviewData of reviewsWithDetails">
                  <div class="flex-shrink-0 me-3">
                    <img [src]="reviewData.user?.image" alt="User"
                         class="avatar-md rounded-circle">
                  </div>
                  <div class="flex-grow-1">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                      <div>
                        <h6 class="mb-0">{{reviewData.user?.prenom }} {{reviewData.user?.nom }}</h6>
                      </div>
                      <div *ngIf="reviewData.sentiment" class="ml-2">
                <span class="badge"
                      [ngClass]="{
                    'bg-success-subtle text-success': reviewData.sentiment.label === 'POSITIVE',
                    'bg-danger-subtle text-danger': reviewData.sentiment.label === 'NEGATIVE',
                    'bg-warning-subtle text-warning': reviewData.sentiment.label === 'NEUTRAL'
                  }">
                  <i class="bi"
                     [ngClass]="{
                      'bi-emoji-smile': reviewData.sentiment.label === 'POSITIVE',
                      'bi-emoji-frown': reviewData.sentiment.label === 'NEGATIVE',
                      'bi-emoji-neutral': reviewData.sentiment.label === 'NEUTRAL'
                    }"></i>
                  {{reviewData.sentiment.label | titlecase}} ({{(reviewData.sentiment.score * 100).toFixed(0)}}%)
                </span>
                      </div>
                      <div *ngIf="!reviewData.sentiment && reviewData.isAnalyzing" class="ml-2">
                <span class="badge bg-secondary-subtle text-secondary">
                  <span class="spinner-border spinner-border-sm me-1"></span> Analyzing...
                </span>
                      </div>
                    </div>
                    <p class="mb-0">{{reviewData.review.text}}</p>
                  </div>
                </div>
              </div>
              <ng-template #noReviews>
                <div class="text-center py-5">
                  <div class="avatar-md mx-auto mb-3">
                    <div class="avatar-title rounded-circle bg-light text-primary">
                      <i class="bi bi-chat-square-text fs-24"></i>
                    </div>
                  </div>
                  <h5>No Reviews Yet</h5>
                  <p class="text-muted">This camping center hasn't received any reviews yet.</p>
                </div>
              </ng-template>
            </ngx-simplebar>
          </div>
        </div>
      </div>
      <!--end col-->
    </div><!--end row-->
  </div><!--end col-->
</div><!--end row-->

<div bsModal #addLogement="bs-modal" class="modal fade" id="addLogement">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addLogementModalLabel">Add Logement</h5>
        <button type="button" class="btn-close" (click)="addLogement.hide()"></button>
      </div>

      <form (ngSubmit)="saveLogement()" [formGroup]="logementForm" class="tablelist-form" novalidate autocomplete="off">
        <div class="modal-body">
          <div id="alert-error-msg" class="d-none alert alert-danger py-2"></div>
          <input type="hidden" id="id-field">

          <div class="mb-3">
            <label class="form-label">Logement Image<span class="text-danger">*</span></label>
            <input type="file" formControlName="image" class="form-control" id="image-input" (change)="onChangeLogementImage($event)" required>
          </div>

          <div class="mb-3">
            <label for="logement-name-input" class="form-label">Logement Name<span class="text-danger">*</span></label>
            <input type="text" id="logement-name-input" formControlName="name" class="form-control" placeholder="Enter Logement Name" required>
          </div>

          <div class="mb-3">
            <label for="logement-name-input" class="form-label">Logement Description<span class="text-danger">*</span></label>
            <input type="text" id="logement-desc-input" formControlName="description" class="form-control" placeholder="Enter Logement Name" required>
          </div>

          <div class="mb-3">
            <label for="logement-type-input" class="form-label">Type<span class="text-danger">*</span></label>
            <select id="logement-type-input" formControlName="type" class="form-control" required>
              <option *ngFor="let type of logementTypes" [value]="type">{{ type }}</option>
            </select>
          </div>

          <div class="mb-3">
            <label for="logement-quantity-input" class="form-label">Quantity<span class="text-danger">*</span></label>
            <input type="number" id="logement-quantity-input" formControlName="quantity" class="form-control" placeholder="Enter Quantity" required>
          </div>

          <div class="mb-3">
            <label for="logement-price-input" class="form-label">Price<span class="text-danger">*</span></label>
            <input type="number" id="logement-price-input" formControlName="price" class="form-control" placeholder="Enter Price" required>
          </div>
        </div>
        <div class="modal-footer">
          <div class="hstack gap-2 justify-content-end">
            <button type="button" class="btn btn-ghost-danger" (click)="addLogement.hide()"><i class="bi bi-x-lg align-baseline me-1"></i> Close</button>
            <button type="submit" class="btn btn-primary" id="add-btn">Add</button>
          </div>
        </div>
      </form>
    </div>
    <!-- modal-content -->
  </div>
</div>

<!-- Edit Camping Center Modal -->
<div bsModal #editProperty="bs-modal" id="editProperty" class="modal fade" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edit Camping Center</h5>
        <button type="button" class="btn-close" (click)="editProperty.hide()"></button>
      </div>
      <form [formGroup]="editCampingForm" (ngSubmit)="updateCentreCamping()">
        <div class="modal-body">
          <div class="mb-3">
            <label for="edit-centre-name-input" class="form-label">Centre Name<span class="text-danger">*</span></label>
            <input type="text" id="edit-centre-name-input" formControlName="name" class="form-control" placeholder="Enter Centre Name" required>
          </div>
          <div class="mb-3">
            <label for="edit-map" class="form-label">Select Location on Map</label>
            <div id="edit-map" style="height: 300px;"></div>
          </div>
          <div class="mb-3" style="display: none;">
            <label for="edit-longitude-input" class="form-label">Longitude<span class="text-danger">*</span></label>
            <input type="text" id="edit-longitude-input" formControlName="longitude" class="form-control" placeholder="Enter Longitude" required>
          </div>
          <div class="mb-3" style="display: none;">
            <label for="edit-latitude-input" class="form-label">Latitude<span class="text-danger">*</span></label>
            <input type="text" id="edit-latitude-input" formControlName="latitude" class="form-control" placeholder="Enter Latitude" required>
          </div>
          <div class="mb-3">
            <label for="edit-address-input" class="form-label">Address<span class="text-danger">*</span></label>
            <input type="text" id="edit-address-input" formControlName="address" class="form-control" placeholder="Enter Address" readonly required>
          </div>
          <div class="mb-3">
            <label for="edit-capacity-input" class="form-label">Capacity<span class="text-danger">*</span></label>
            <input type="number" id="edit-capacity-input" formControlName="capcite" class="form-control" placeholder="Enter Capacity" required>
          </div>
          <div class="mb-3">
            <label for="edit-prixJr-input" class="form-label">Prix Jour<span class="text-danger">*</span></label>
            <input type="number" id="edit-prixJr-input" formControlName="prixJr" class="form-control" placeholder="Enter Prix Jour" required>
          </div>
          <div class="mb-3">
            <label for="edit-numTel-input" class="form-label">Phone Number<span class="text-danger">*</span></label>
            <input type="text" id="edit-numTel-input" formControlName="numTel" class="form-control" placeholder="Enter Phone Number" required>
          </div>
          <div class="mb-3">
            <label for="edit-image-input" class="form-label">Image<span class="text-danger">*</span></label>
            <input type="file" id="edit-image-input" (change)="onChangeImage($event)" class="form-control" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-ghost-danger" (click)="editProperty.hide()"><i class="bi bi-x-lg align-baseline me-1"></i> Close</button>
          <button type="submit" class="btn btn-primary">Update</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div bsModal #deleteRecordModal="bs-modal" id="deleteRecordModal" class="modal fade zoomIn" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="btn-close" (click)="deleteRecordModal.hide()"></button>
      </div>
      <div class="modal-body p-md-5">
        <div class="text-center">
          <div class="text-danger">
            <i class="bi bi-trash display-5"></i>
          </div>
          <div class="mt-4">
            <h4 class="mb-2">Are you sure?</h4>
            <p class="text-muted mx-3 mb-0">Are you sure you want to remove this camping center?</p>
          </div>
        </div>
        <div class="d-flex gap-2 justify-content-center mt-4 pt-2 mb-2">
          <button type="button" class="btn w-sm btn-light btn-hover" (click)="deleteRecordModal.hide()">Close</button>
          <button type="button" class="btn w-sm btn-danger btn-hover" id="remove-element" (click)="confirmDelete()">Yes, Delete It!</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Add the edit logement modal -->
<div bsModal #editLogementModal="bs-modal" class="modal fade" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edit Logement</h5>
        <button type="button" class="btn-close" (click)="editLogementModal.hide()"></button>
      </div>
      <form [formGroup]="editLogementForm" (ngSubmit)="updateLogement()">
        <div class="modal-body">
          <div class="mb-3">
            <label for="edit-logement-image-input" class="form-label">Image<span class="text-danger">*</span></label>
            <input type="file" id="edit-logement-image-input" (change)="onChangeImage($event)" class="form-control" required>
          </div>

          <div class="mb-3">
            <label for="edit-logement-name-input" class="form-label">Logement Name<span class="text-danger">*</span></label>
            <input type="text" id="edit-logement-name-input" formControlName="name" class="form-control" placeholder="Enter Logement Name" required>
          </div>
          <div class="mb-3">
            <label for="edit-logement-name-input" class="form-label">Logement Description<span class="text-danger">*</span></label>
            <input type="text" id="edit-logement-desc-input" formControlName="description" class="form-control" placeholder="Enter Logement Name" required>
          </div>

          <div class="mb-3">
            <label for="edit-logement-type-input" class="form-label">Type<span class="text-danger">*</span></label>
            <select id="edit-logement-type-input" formControlName="type" class="form-control" required>
              <option *ngFor="let type of logementTypes" [value]="type">{{ type }}</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="edit-logement-quantity-input" class="form-label">Quantity<span class="text-danger">*</span></label>
            <input type="number" id="edit-logement-quantity-input" formControlName="quantity" class="form-control" placeholder="Enter Quantity" required>
          </div>
          <div class="mb-3">
            <label for="edit-logement-price-input" class="form-label">Price<span class="text-danger">*</span></label>
            <input type="number" id="edit-logement-price-input" formControlName="price" class="form-control" placeholder="Enter Price" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-ghost-danger" (click)="editLogementModal.hide()"><i class="bi bi-x-lg align-baseline me-1"></i> Close</button>
          <button type="submit" class="btn btn-primary">Update</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Delete Logement Confirmation Modal -->
<div bsModal #deleteRecordLogementModal="bs-modal" id="deleteRecordLogementModal" class="modal fade zoomIn" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="btn-close" (click)="deleteRecordLogementModal.hide()"></button>
      </div>
      <div class="modal-body p-md-5">
        <div class="text-center">
          <div class="text-danger">
            <i class="bi bi-trash display-5"></i>
          </div>
          <div class="mt-4">
            <h4 class="mb-2">Are you sure?</h4>
            <p class="text-muted mx-3 mb-0">Are you sure you want to remove this logement?</p>
          </div>
        </div>
        <div class="d-flex gap-2 justify-content-center mt-4 pt-2 mb-2">
          <button type="button" class="btn w-sm btn-light btn-hover" (click)="deleteRecordLogementModal.hide()">Close</button>
          <button type="button" class="btn w-sm btn-danger btn-hover" id="remove-element1" (click)="confirmDeleteLogement()">Yes, Delete It!</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Add Materiel Modal -->
<div bsModal #addMateriel="bs-modal" class="modal fade" id="addMateriel">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addMaterielModalLabel">Add Materiel</h5>
        <button type="button" class="btn-close" (click)="addMateriel.hide()"></button>
      </div>

      <form (ngSubmit)="saveMateriel()" [formGroup]="materielForm" class="tablelist-form" novalidate autocomplete="off">
        <div class="modal-body">
          <div id="alert-error-msg1" class="d-none alert alert-danger py-2"></div>
          <input type="hidden" id="id-field1">

          <div class="mb-3">
            <label class="form-label">Materiel Image<span class="text-danger">*</span></label>
            <input type="file" formControlName="image" class="form-control" id="image-input1" (change)="onChangeMaterielImage($event)" required>
          </div>

          <div class="mb-3">
            <label for="materiel-name-input" class="form-label">Materiel Name<span class="text-danger">*</span></label>
            <input type="text" id="materiel-name-input" formControlName="name" class="form-control" placeholder="Enter Materiel Name" required>
          </div>

          <div class="mb-3">
            <label for="materiel-name-input" class="form-label">Materiel Description<span class="text-danger">*</span></label>
            <input type="text" id="materiel-description-input" formControlName="description" class="form-control" placeholder="Enter Materiel Name" required>
          </div>
          <div class="mb-3">
            <label for="materiel-type-input" class="form-label">Material Type<span class="text-danger">*</span></label>
            <select id="materiel-type-input" formControlName="type" class="form-control" required>
              <option value="" disabled selected>Select Material Type</option>
              <option [value]="typeMateriel.MATERIEL_DE_COUCHAGE">Sleeping Equipment</option>
              <option [value]="typeMateriel.MOBILIER_DE_CAMPING">Camping Furniture</option>
              <option [value]="typeMateriel.CUISINE_ET_ALIMENTATION">Cooking & Food Equipment</option>
              <option [value]="typeMateriel.EQUIPEMENT_DE_SECURITE">Safety Equipment</option>
              <option [value]="typeMateriel.EQUIPEMENTS_DE_LOISIRS">Leisure Equipment</option>
            </select>
          </div>


          <div class="mb-3">
            <label for="materiel-quantity-input" class="form-label">Quantity<span class="text-danger">*</span></label>
            <input type="number" id="materiel-quantity-input" formControlName="quantity" class="form-control" placeholder="Enter Quantity" required>
          </div>

          <div class="mb-3">
            <label for="materiel-price-input" class="form-label">Price<span class="text-danger">*</span></label>
            <input type="number" id="materiel-price-input" formControlName="price" class="form-control" placeholder="Enter Price" required>
          </div>
        </div>
        <div class="modal-footer">
          <div class="hstack gap-2 justify-content-end">
            <button type="button" class="btn btn-ghost-danger" (click)="addMateriel.hide()"><i class="bi bi-x-lg align-baseline me-1"></i> Close</button>
            <button type="submit" class="btn btn-primary" id="add-btn1">Add</button>
          </div>
        </div>
      </form>
    </div>
    <!-- modal-content -->
  </div>
</div>

<div bsModal #editMaterielModal="bs-modal" class="modal fade" id="editMaterielModal">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edit Materiel</h5>
        <button type="button" class="btn-close" (click)="editMaterielModal.hide()"></button>
      </div>
      <form (ngSubmit)="updateMateriel()" [formGroup]="editMaterielForm" novalidate>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Materiel Image<span class="text-danger">*</span></label>
            <input type="file" class="form-control" (change)="onChangeMaterielImage($event)">
          </div>
          <div class="mb-3">
            <label class="form-label">Materiel Name<span class="text-danger">*</span></label>
            <input type="text" formControlName="name" class="form-control" placeholder="Enter Materiel Name" required>
          </div>
          <div class="mb-3">
            <label for="materiel-name-input" class="form-label">Materiel Description<span class="text-danger">*</span></label>
            <input type="text" formControlName="description" class="form-control" placeholder="Enter Materiel Name" required>
          </div>
          <div class="mb-3">
            <label for="edit-materiel-type-input" class="form-label">Material Type<span class="text-danger">*</span></label>
            <select id="edit-materiel-type-input" formControlName="type" class="form-control" required>
              <option value="" disabled>Select Material Type</option>
              <option [value]="typeMateriel.MATERIEL_DE_COUCHAGE">Sleeping Equipment</option>
              <option [value]="typeMateriel.MOBILIER_DE_CAMPING">Camping Furniture</option>
              <option [value]="typeMateriel.CUISINE_ET_ALIMENTATION">Cooking & Food Equipment</option>
              <option [value]="typeMateriel.EQUIPEMENT_DE_SECURITE">Safety Equipment</option>
              <option [value]="typeMateriel.EQUIPEMENTS_DE_LOISIRS">Leisure Equipment</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Quantity<span class="text-danger">*</span></label>
            <input type="number" formControlName="quantity" class="form-control" placeholder="Enter Quantity" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Price<span class="text-danger">*</span></label>
            <input type="number" formControlName="price" class="form-control" placeholder="Enter Price" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" (click)="editMaterielModal.hide()">Close</button>
          <button type="submit" class="btn btn-primary">Update</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Delete Materiel Confirmation Modal -->
<div bsModal #deleteRecordMaterielModal="bs-modal" class="modal fade" id="deleteRecordMaterielModal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="btn-close" (click)="deleteRecordMaterielModal.hide()"></button>
      </div>
      <div class="modal-body text-center">
        <div class="text-danger">
          <i class="bi bi-trash display-5"></i>
        </div>
        <h4 class="mt-4">Are you sure?</h4>
        <p class="text-muted">Do you really want to delete this materiel? This process cannot be undone.</p>
        <div class="d-flex justify-content-center mt-4">
          <button type="button" class="btn btn-light" (click)="deleteRecordMaterielModal.hide()">Cancel</button>
          <button type="button" class="btn btn-danger" (click)="confirmDeleteMateriel()">Yes, Delete</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Reservation Details Modal -->
<div bsModal #reservationModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="reservationModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header p-3 bg-info-subtle">
        <h5 class="modal-title" id="reservationModalLabel">Reservation Details</h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>
      <div class="modal-body p-4">
        @if (selectedReservation) {
          <div class="reservation-details">
            <!-- Reservation Header -->
            <div class="card mb-4 border-0 bg-light-subtle">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h5 class="mb-0">{{ clientData?.prenom }} {{clientData?.nom}}</h5>
                  <span class="badge" [ngClass]="selectedReservation.confirmed ? 'bg-success' : 'bg-danger'">
                    {{ selectedReservation.confirmed ? 'Confirmed' : 'Not Confirmed' }}
                  </span>
                </div>
                <div class="row">
                  <div class="col-md-6">
                    <div class="mb-2">
                      <i class="ri-mail-line me-1 text-muted"></i>
                      <span>{{ clientData?.email || 'No email provided' }}</span>
                    </div>
                    <div class="mb-2">
                      <i class="ri-phone-line me-1 text-muted"></i>
                      <span>{{ clientData?.tel || 'No phone provided' }}</span>
                    </div>
                    <div class="mb-2">
                      <i class="ri-user-line me-1 text-muted"></i>
                      <span>{{ selectedReservation.nbrPersonnes }} Guests</span>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="mb-2">
                      <i class="ri-calendar-event-line me-1 text-muted"></i>
                      <span>Check-in: {{ formatDate(selectedReservation.dateDebut) }}</span>
                    </div>
                    <div class="mb-2">
                      <i class="ri-calendar-event-line me-1 text-muted"></i>
                      <span>Check-out: {{ formatDate(selectedReservation.dateFin) }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Reserved Items -->
            <h6 class="fw-bold mb-3">Reserved Items</h6>
            @if (selectedReservation.lignesReservation && selectedReservation.lignesReservation.length > 0) {
              <div class="table-responsive mb-3">
                <table class="table align-middle">
                  <thead class="table-light">
                  <tr>
                    <th>Item</th>
                    <th>Type</th>
                    <th>Price/Day</th>
                    <th>Quantity</th>
                    <th>Days</th>
                    <th class="text-end">Subtotal</th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr *ngFor="let ligne of selectedReservation.lignesReservation">
                    <td>
                      <div class="d-flex align-items-center">
                        <img [src]="ligne.logement?.image || ligne.materiel?.image" alt="" class="rounded" width="40">
                        <div class="ms-2">
                          <span>{{ ligne.logement?.type || ligne.materiel?.name }}</span>
                        </div>
                      </div>
                    </td>
                    <td>{{ ligne.logement ? 'Logement' : 'Materiel' }}</td>
                    <td>{{ ligne.prix / ligne.quantite }} TND</td>
                    <td>{{ ligne.quantite }}</td>
                    <td>{{ calculateDaysDifference(ligne.dateDebut, ligne.dateFin) }}</td>
                    <td class="text-end">{{ ligne.prix }} TND</td>
                  </tr>
                  </tbody>
                </table>
              </div>
            } @else {
              <div class="alert alert-info">No items in this reservation.</div>
            }

            <!-- Pricing Summary -->
            <div class="card border-0 bg-light-subtle mb-4">
              <div class="card-body">
                <h6 class="fw-bold mb-3">Price Summary</h6>
                <div class="d-flex justify-content-between mb-2">
                  <span>Camping Fee:</span>
                  <span>{{ selectedReservation.prixCamping | currency:'TND' }}</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                  <span>Items Total:</span>
                  <span>{{ selectedReservation.prixLigne | currency:'TND' }}</span>
                </div>
                <hr>
                <div class="d-flex justify-content-between fw-bold">
                  <span>Total Price:</span>
                  <span>{{ selectedReservation.prixTotal | currency:'TND' }}</span>
                </div>
              </div>
            </div>
          </div>
        }
      </div>
      <div class="modal-footer">
        <button *ngIf="selectedReservation && !selectedReservation.confirmed"
                type="button"
                class="btn btn-success"
                (click)="confirmReservation(selectedReservation.idReservation)">
          <i class="bi bi-check-circle me-1"></i> Confirm Reservation
        </button>
        <button type="button" class="btn btn-light" (click)="closeModal()">Close</button>
      </div>
    </div>
  </div>
</div>

