
<!-- Start Breadcrumbs -->
<app-breadcrumbs title="Forum Management" [breadcrumbItems]="breadCrumbItems"></app-breadcrumbs>
<!-- End Breadcrumbs -->





<div class="row">
  <div class="col-xxl-3 col-md-6">
    <div class="card">
      <div class="card-body">
        <div class="d-flex">
          <div class="flex-grow-1">
            <div class="d-flex flex-column h-100">
              <p class="fs-md text-muted mb-4">Posts</p>
              <h3 class="mb-0 mt-auto"><span class="counter-value" [countUp]="totalPosts"></span>
                <!-- Posts card -->
<small class="{{weeklyTrends?.posts?.isPositive ? 'text-success' : 'text-danger'}} fs-xs mb-0 ms-1">
                  <i class="bi bi-arrow-{{weeklyTrends?.posts?.isPositive ? 'up' : 'down'}} me-1"></i>
                  {{(weeklyTrends?.posts?.percentage || 0) | number:'1.2-2'}}%
                </small>
              </h3>
            </div>
          </div>
          <div class="flex-shrink-0">
            <div id="property_sale" class="apex-charts" dir="ltr">
              <apx-chart [series]="saleChart.series" [chart]="saleChart.chart" [plotOptions]="saleChart.plotOptions" [grid]="saleChart.grid" [stroke]="saleChart.stroke" [labels]="saleChart.labels" [colors]="saleChart.colors" dir="ltr"></apx-chart>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div><!--end col-->
  <div class="col-xxl-3 col-md-6">
    <div class="card">
      <div class="card-body">
        <div class="d-flex">
          <div class="flex-grow-1">
            <div class="d-flex flex-column h-100">
              <p class="fs-md text-muted mb-4">Comments</p>
              <h3 class="mb-0 mt-auto"><span class="counter-value" [countUp]="totalComments"></span>
<small class="{{weeklyTrends?.comments?.isPositive ? 'text-success' : 'text-danger'}} fs-xs mb-0 ms-1">
                  <i class="bi bi-arrow-{{weeklyTrends?.comments?.isPositive ? 'up' : 'down'}} me-1"></i>
                  {{(weeklyTrends?.comments?.percentage || 0) | number:'1.2-2'}}%
                </small>
              </h3>
            </div>
          </div>
          <div class="flex-shrink-0">
            <div id="property_rent" class="apex-charts" dir="ltr">
              <apx-chart [series]="visitorsChart.series" [chart]="visitorsChart.chart" [plotOptions]="visitorsChart.plotOptions" [grid]="visitorsChart.grid" [stroke]="visitorsChart.stroke" [labels]="visitorsChart.labels" [colors]="visitorsChart.colors" dir="ltr"></apx-chart>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div><!--end col-->
  <div class="col-xxl-3 col-md-6">
    <div class="card">
      <div class="card-body">
        <div class="d-flex">
          <div class="flex-grow-1">
            <div class="d-flex flex-column h-100">
              <p class="fs-md text-muted mb-4">Media</p>
              <h3 class="mb-0 mt-auto"><span class="counter-value" [countUp]="totalMedia"></span>
<small class="{{weeklyTrends?.media?.isPositive ? 'text-success' : 'text-danger'}} fs-xs mb-0 ms-1">
                  <i class="bi bi-arrow-{{weeklyTrends?.media?.isPositive ? 'up' : 'down'}} me-1"></i>
                  {{(weeklyTrends?.media?.percentage || 0) | number:'1.2-2'}}%
                </small>
              </h3>
            </div>
          </div>
          <div class="flex-shrink-0">
            <div id="visitors_chart" class="apex-charts" dir="ltr">
              <apx-chart [series]="rentChart.series" [chart]="rentChart.chart" [plotOptions]="rentChart.plotOptions" [grid]="rentChart.grid" [stroke]="rentChart.stroke" [labels]="rentChart.labels" [colors]="rentChart.colors"></apx-chart>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div><!--end col-->
  <div class="col-xxl-3 col-md-6">
    <div class="card">
      <div class="card-body">
        <div class="d-flex">
          <div class="flex-grow-1">
            <div class="d-flex flex-column h-100">
              <p class="fs-md text-muted mb-4">Reactions</p>
              <h3 class="mb-0 mt-auto"><span class="counter-value" [countUp]="totalReactions"></span>
<small class="{{weeklyTrends?.reactions?.isPositive ? 'text-success' : 'text-danger'}} fs-xs mb-0 ms-1">
                  <i class="bi bi-arrow-{{weeklyTrends?.reactions?.isPositive ? 'up' : 'down'}} me-1"></i>
                  {{(weeklyTrends?.reactions?.percentage || 0) | number:'1.2-2'}}%
                </small>
              </h3>
            </div>
          </div>
          <div class="flex-shrink-0">
            <div id="residency_property" class="apex-charts" dir="ltr">
              <apx-chart [series]="residencypropertyChart.series" [chart]="residencypropertyChart.chart" [plotOptions]="residencypropertyChart.plotOptions" [grid]="residencypropertyChart.grid" [stroke]="residencypropertyChart.stroke" [labels]="residencypropertyChart.labels" [colors]="residencypropertyChart.colors" dir="ltr"></apx-chart>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div><!--end col-->
</div><!--end row-->




<!-- File: src/app/pages/gestion-forum/admin/dashboard-forum/dashboard-forum.component.html -->
<!-- HTML -->
<div class="row mb-4">


  <div class="col-xxl-4 order-last order-xxl-first">
<div class="card h-100">
      <div class="card-header d-flex">
        <h4 class="card-title mb-0 flex-grow-1">Activité Quotidienne</h4>
        <div class="flex-shrink-0">
          <input type="text"
                 class="form-control form-control-sm"
                 id="exampleInputPassword1"
                 mwlFlatpickr
                 [(ngModel)]="currentDate"
                 (ngModelChange)="onDateChange($event)"
                 altFormat="d M, Y"
                 dateFormat="d M, Y"
                 mode="range"
                 [altInput]="true"
                 [convertModelValue]="true"
                 placeholder="Aujourd'hui">
        </div>
      </div>
      <div class="card-body">
        <div class="row mb-3">
          <div class="col-12">
            <div class="d-flex align-items-center">
              <div class="flex-grow-1">
                <h6 class="mb-0">Date sélectionnée:</h6>
                <p class="text-muted mb-0">{{currentDate?.from | date:'dd MMMM yyyy'}}
                  <span *ngIf="currentDate?.to && currentDate.to !== currentDate.from">
                    - {{currentDate?.to | date:'dd MMMM yyyy'}}
                  </span>
                </p>
              </div>
            </div>
          </div>
        </div>
        <div *ngIf="dataFound; else noData">
          <div echarts
               [options]="propertytypeChart"
               id="property_type"
               style="height: 336px;"></div>
        </div>
        <ng-template #noData>
          <div class="text-center p-5">
            <div class="avatar-md mx-auto mb-3">
              <div class="avatar-title rounded-circle bg-light text-primary">
                <i class="bi bi-bar-chart-line fs-3"></i>
              </div>
            </div>
            <h5>Aucune donnée trouvée</h5>
            <p class="text-muted">Aucune activité enregistrée pour cette période.</p>
          </div>
        </ng-template>
      </div>
    </div>
  </div><!--end col-->


  <div class="col-xxl-8">
    <div class="card h-100" >
      <div class="card-header d-flex align-items-center">
        <h4 class="card-title mb-0 flex-grow-1">Activité du Forum</h4>
        <div class="flex-shrink-0">
          <div class="form-group position-relative mb-0">
            <input
              type="text"
              class="form-control form-control-sm"
              id="calendarDatePicker"
              placeholder="Choisir une date"
              mwlFlatpickr
              [(ngModel)]="selectedDate"
              (ngModelChange)="onCalendarDateChange($event)"
              altFormat="d M, Y"
              dateFormat="d M, Y"
              [altInput]="true"
              [convertModelValue]="true">
          </div>
        </div>
      </div>
      <div class="card-body">
        <div class="row mb-3">
          <div class="col-md-6">
            <div class="d-flex align-items-center">
              <div class="flex-grow-1">
                <h6 class="mb-0">Date sélectionnée:</h6>
                <p class="text-muted mb-0">{{selectedDate | date:'dd MMMM yyyy'}}</p>
              </div>
            </div>
          </div>
          <div class="col-md-6" *ngIf="peakHoursData">
            <div class="d-flex align-items-center">
              <div class="flex-grow-1">
                <h6 class="mb-0">Heure de pointe:</h6>
                <p class="text-muted mb-0">
                  <span class="badge bg-success-subtle text-success">{{peakHoursData.peakHourFormatted}}</span>
                  <span class="ms-2">{{peakHoursData.peakCount}} activités:
                    <span class="badge bg-primary-subtle text-primary me-1">Posts: {{peakHoursData.hourlyBreakdown[peakHoursData.peakHour]?.posts || 0}}</span>
                    <span class="badge bg-info-subtle text-info me-1">Comments: {{peakHoursData.hourlyBreakdown[peakHoursData.peakHour]?.comments || 0}}</span>
                    <span class="badge bg-warning-subtle text-warning">Reactions: {{peakHoursData.hourlyBreakdown[peakHoursData.peakHour]?.reactions || 0}}</span>
                  </span>                </p>
              </div>
            </div>
          </div>
        </div>

        <div id="total_income" class="apex-charts" dir="ltr">
          <apx-chart
            [series]="propertysaleChart.series"
            [chart]="propertysaleChart.chart"
            [plotOptions]="propertysaleChart.plotOptions"
            [grid]="propertysaleChart.grid"
            [colors]="propertysaleChart.colors"
            [fill]="propertysaleChart.fill"
            [dataLabels]="propertysaleChart.dataLabels"
            [yaxis]="propertysaleChart.yaxis"
            [legend]="propertysaleChart.legend"
            [xaxis]="propertysaleChart.xaxis"
            dir="ltr">
          </apx-chart>
        </div>
      </div>
    </div>
  </div>
</div>

<!--end row-->



<div class="row mb-4">

<div class="col-xxl-8">
    <div class="card h-100 shadow-sm border-0">
      <div class="card-header d-flex align-items-center bg-light-subtle p-3">
        <div class="d-flex align-items-center flex-grow-1">
          <div class="avatar-sm bg-primary bg-opacity-10 text-primary rounded me-3">
            <i class="bi bi-newspaper fs-4 p-2 d-flex align-items-center justify-content-center h-100"></i>
          </div>
          <h5 class="card-title mb-0">Publications récentes</h5>
        </div>
        <div class="flex-shrink-0">
          <a [routerLink]="['/forumback/admin/posts']" class="btn btn-sm btn-primary rounded-pill">
            <i class="bi bi-grid-3x3-gap-fill me-1"></i> Tout afficher
          </a>
        </div>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="text-muted bg-light">
              <tr>
                <th class="ps-3">Utilisateur</th>
                <th>Contenu</th>
                <th class="text-center"><i class="bi bi-chat-left-text me-1"></i> Comments</th>
                <th class="text-center"><i class="bi bi-hand-thumbs-up me-1"></i> Reactions</th>
                <th><i class="bi bi-calendar3 me-1"></i> Date</th>
                <th class="text-end pe-3">Action</th>
              </tr>
            </thead>
            <tbody>
              @for (post of recentPosts; track post.id) {
                <tr class="align-middle">
                  <td class="ps-3">
                    <div class="d-flex align-items-center">
                      <div class="avatar avatar-sm me-2 bg-primary-subtle text-primary rounded-circle">
                        <span class="avatar-title">{{post.username?.charAt(0)}}</span>
                      </div>
                      <div class="fw-medium text-body">{{post.username}}</div>
                    </div>
                  </td>
                  <td>
                    <div class="d-flex align-items-center gap-3 position-relative">
                      <!-- Media thumbnail with improved styling -->
                      <div class="media-thumbnail position-relative rounded-3 border" style="width: 55px; height: 40px; overflow: hidden;">
                        <ng-container *ngIf="post.media && post.media.length > 0">
                          <img *ngIf="post.media[0].mediaType === 'VIDEO'"
                               src="assets/images/imagesForum/video.jpg"
                               alt="Video"
                               class="w-100 h-100 object-fit-cover">
                          <div *ngIf="post.media[0].mediaType === 'VIDEO'" class="position-absolute top-50 start-50 translate-middle text-white">
                            <i class="bi bi-play-circle-fill"></i>
                          </div>
                          <img *ngIf="post.media[0].mediaType !== 'VIDEO'"
                               [src]="post.media[0].mediaUrl"
                               alt=""
                               class="w-100 h-100 object-fit-cover">
                        </ng-container>
                        <div *ngIf="!post.media || post.media.length === 0" class="d-flex align-items-center justify-content-center h-100 w-100 bg-light">
                          <i class="bi bi-card-text text-muted"></i>
                        </div>
                      </div>

                      <a [routerLink]="['/gestion-forum/post', post.id]" class="fw-medium text-primary text-decoration-none stretched-link">
                        {{(post.content?.length ?? 0) > 30 ? post.content?.substring(0, 30) + '...' : post.content}}
                      </a>
                    </div>
                  </td>
                  <td class="text-center">
                    <span class="badge bg-info-subtle text-info rounded-pill">
                      {{post.comments?.length || 0}}
                    </span>
                  </td>
                  <td class="text-center">
                    <span class="badge bg-warning-subtle text-warning rounded-pill">
                      {{post.reactions?.length || 0}}
                    </span>
                  </td>
                  <td>
                    <div class="d-flex align-items-center">
                      <i class="bi bi-clock-history text-muted me-1 fs-sm"></i>
                      <span class="text-body-secondary">{{post.createdAt | date:'dd MMM yyyy'}}</span>
                    </div>
                  </td>
                  <td class="text-end pe-3">
                    <div class="d-flex gap-2 justify-content-end">
                      <a [routerLink]="['/gestion-forum/post', post.id]"
                         class="btn btn-sm btn-primary rounded-circle"
                         data-bs-toggle="tooltip"
                         data-bs-placement="top"
                         title="Voir le post">
                        <i class="bi bi-eye-fill"></i>
                      </a>
                      <button type="button"
                             class="btn btn-sm btn-danger rounded-circle remove-item-btn"
                             data-bs-toggle="tooltip"
                             data-bs-placement="top"
                             title="Supprimer">
                        <i class="bi bi-trash3-fill"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              }
            </tbody>
          </table>

          <!-- Empty state with improved styling -->
          <div class="noresult p-4" [style.display]="recentPosts.length === 0 ? 'block' : 'none'">
            <div class="text-center">
              <div class="avatar-lg mx-auto mb-4">
                <div class="avatar-title bg-primary-subtle text-primary rounded-circle">
                  <i class="bi bi-clipboard-x fs-1"></i>
                </div>
              </div>
              <h5 class="mt-2">Aucune publication trouvée</h5>
              <p class="text-muted">Aucune publication n'est disponible dans le système pour le moment.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
<div class="col-xxl-4 col-lg-6">
    <div class="card h-100">
      <div class="card-header d-flex align-items-center border-bottom">
        <h4 class="card-title mb-0 flex-grow-1">
          <i class="bi bi-award-fill me-1 text-warning"></i>
          Publications Populaires
        </h4>
        <div class="flex-shrink-0">
          <button type="button" class="btn btn-sm btn-ghost-primary">
            <i class="bi bi-calendar3 me-1"></i> Ce mois
          </button>
        </div>
      </div>
      <div class="card-body p-0">
        <div *ngIf="topRatedPosts.length > 0; else noPopularPosts" class="d-flex flex-column h-100">
          @for (post of topRatedPosts.slice(0, 5); track $index) {
            <div class="d-flex gap-3 p-3 position-relative {{ $index < 4 ? 'border-bottom' : '' }}">
              <!-- Rank badge -->
              <div class="position-absolute top-0 start-0 ms-2 mt-2">
                <span class="badge bg-primary rounded-pill fw-medium fs-xs"></span>
              </div>

              <!-- Media thumbnail with consistent styling -->
              <div class="flex-shrink-0 mt-2">
                <div class="position-relative" style="width: 60px; height: 60px; overflow: hidden;">
                  <!-- Image pour les médias de type IMAGE -->
                  <img *ngIf="post.post.hasMedia && post.post.media && post.post.media.length > 0 && post.post.media[0].mediaType === 'IMAGE'"
                       [src]="post.post.media[0].mediaUrl"
                       alt=""
                       class="w-100 h-100 object-fit-cover rounded border"
                       style="box-shadow: 0 2px 5px rgba(0,0,0,0.08);">
                  <!-- Image placeholder pour les vidéos -->
                  <img *ngIf="post.post.hasMedia && post.post.media && post.post.media.length > 0 && post.post.media[0].mediaType === 'VIDEO'"
                       src="assets/images/imagesForum/video.jpg"
                       alt="Video"
                       class="w-100 h-100 object-fit-cover rounded border"
                       style="box-shadow: 0 2px 5px rgba(0,0,0,0.08);">
                  <!-- Video play indicator -->
                  <span *ngIf="post.post.hasMedia && post.post.media && post.post.media.length > 0 && post.post.media[0].mediaType === 'VIDEO'"
                        class="position-absolute top-50 start-50 translate-middle text-white">
                    <i class="bi bi-play-circle-fill fs-4"></i>
                  </span>
                  <!-- Fallback pour les posts sans média -->
                  <div *ngIf="!post.post.hasMedia || !post.post.media || post.post.media.length === 0"
                       class="avatar avatar-md bg-light-subtle text-primary d-flex align-items-center justify-content-center rounded w-100 h-100 border"
                       style="box-shadow: 0 2px 5px rgba(0,0,0,0.08);">
                    <i class="bi bi-file-text fs-4"></i>
                  </div>
                </div>
              </div>

              <div class="flex-grow-1">
                <!-- Rating badge - more prominent -->
                <div class="d-flex align-items-center mb-2">
                  <span class="badge rounded-pill bg-warning-subtle text-warning me-2">
                    <i class="bi bi-star-fill me-1"></i>{{post.rating}}
                  </span>
                  <small class="text-muted fs-xs">
                    {{post.post.createdAt | date:'dd MMM yyyy'}}
                  </small>
                </div>

                <!-- Post title with better styling -->
                <a routerLink="/pages/gestion-forum/post/{{post.post.id}}" class="stretched-link text-decoration-none">
                  <h6 class="mb-2 text-truncate fw-medium" style="max-width: 100%;">
                    {{post.post.content | slice:0:50}}{{post.post.content.length > 50 ? '...' : ''}}
                  </h6>
                </a>

                <!-- User info and metrics -->
                <div class="d-flex justify-content-between align-items-center">
                  <div class="d-flex align-items-center">
                    <i class="bi bi-person-circle text-primary me-1 fs-5"></i>
                    <span class="text-muted fs-xs fw-medium">{{post.post.username}}</span>
                  </div>

                  <div class="d-flex align-items-center gap-2">
                    <span class="badge rounded-pill bg-light-subtle text-body px-2 py-1">
                      <i class="bi bi-chat-dots text-primary me-1"></i>
                      {{post.commentCount || 0}}
                    </span>
                    <span class="badge rounded-pill bg-light-subtle text-body px-2 py-1">
                      <i class="bi bi-hand-thumbs-up text-primary me-1"></i>
                      {{post.reactionCount || 0}}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          }
        </div>
        <ng-template #noPopularPosts>
          <div class="text-center p-4">
            <div class="avatar-lg mx-auto mb-3">
              <div class="avatar-title rounded-circle bg-light-subtle text-primary">
                <i class="bi bi-trophy fs-3"></i>
              </div>
            </div>
            <h5 class="fw-semibold">Aucune publication populaire</h5>
            <p class="text-muted">Les publications populaires apparaîtront ici une fois qu'elles auront reçu suffisamment d'interactions.</p>
            <button type="button" class="btn btn-sm btn-primary mt-2">
              <i class="bi bi-plus-circle me-1"></i> Créer une publication
            </button>
          </div>
        </ng-template>
      </div>
    </div>
  </div>
</div>






